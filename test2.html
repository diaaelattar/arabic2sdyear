<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الاختبار الشامل: الجوهرة المصرية - طلاب الأستاذة إسلام</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="tests.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* أنماط محسنة للاختبار */
        :root {
            --test-primary: #4a6fa5;
            --test-secondary: #166088;
            --test-success: #28a745;
            --test-warning: #ffc107;
            --test-danger: #dc3545;
            --test-info: #17a2b8;
        }

        /* تحسينات عامة */
        .test-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-header {
            background: linear-gradient(135deg, var(--test-primary), var(--test-secondary));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .test-header h1 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .test-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        /* شريط المعلومات */
        .test-meta-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .meta-item i {
            font-size: 1.2rem;
        }

        /* قسم الأسئلة */
        #test-form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .test-question {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .test-question.active {
            border-color: var(--test-primary);
            background: #f0f9ff;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
            animation: questionFadeIn 0.5s ease;
        }

        @keyframes questionFadeIn {
            from { opacity: 0.7; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .question-header h3 {
            color: var(--test-primary);
            font-size: 1.4rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .question-points {
            background: var(--test-primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .question-group {
            margin-bottom: 15px;
        }

        .group-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--test-secondary), var(--test-primary));
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .question-text {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #2d3748;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-right: 4px solid var(--test-primary);
        }

        .question-text.highlight {
            background: #fff9e6;
            border-color: var(--test-warning);
        }

        /* تحسينات لخيارات الإجابة */
        .question-options {
            display: grid;
            gap: 12px;
        }

        .question-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 20px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .question-option:hover {
            border-color: var(--test-primary);
            background: #f8fafc;
            transform: translateX(-5px);
        }

        .question-option.selected {
            border-color: var(--test-primary);
            background: #f0f9ff;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
        }

        .question-option input[type="radio"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: var(--test-primary);
        }

        .option-text {
            flex: 1;
            font-size: 1.05rem;
            color: #4a5568;
            font-weight: 500;
        }

        .option-letter {
            background: var(--test-primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* شريط التنقل بين الأسئلة */
        .test-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .nav-btn {
            background: linear-gradient(135deg, var(--test-primary), var(--test-secondary));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            min-width: 130px;
            justify-content: center;
        }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #9ca3af;
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--test-success), #1e7e34);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(40, 167, 69, 0.2);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.3);
        }

        .submit-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* شريط التقدم */
        .questions-progress {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border: 2px solid #e5e7eb;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-title {
            font-weight: 700;
            color: var(--test-primary);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-count {
            background: linear-gradient(135deg, var(--test-primary), var(--test-secondary));
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1rem;
        }

        .questions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .question-status {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            font-size: 1rem;
        }

        .question-status.answered {
            background: var(--test-success);
            color: white;
            border-color: var(--test-success);
        }

        .question-status.current {
            background: white;
            color: var(--test-primary);
            border-color: var(--test-primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
            transform: scale(1.1);
        }

        .question-status.unanswered {
            background: white;
            color: var(--test-danger);
            border-color: #e5e7eb;
        }

        .question-status:hover:not(.current) {
            transform: scale(1.05);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .question-status::after {
            content: '';
            position: absolute;
            top: -5px;
            right: -5px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--test-warning);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .question-status.current::after {
            opacity: 1;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }

        /* قسم النتائج */
        .test-results {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 30px;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-card h2 {
            text-align: center;
            color: var(--test-primary);
            margin-bottom: 30px;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .results-score {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 50px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--test-primary), var(--test-secondary));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 10px 25px rgba(74, 111, 165, 0.3);
            position: relative;
            animation: scorePop 0.8s ease;
        }

        @keyframes scorePop {
            0% { transform: scale(0); }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .score-value {
            font-size: 3.5rem;
            font-weight: bold;
            line-height: 1;
        }

        .score-label {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .score-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            min-width: 300px;
        }

        .score-stat {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            text-align: center;
            transition: all 0.3s ease;
        }

        .score-stat:hover {
            transform: translateY(-5px);
            border-color: var(--test-primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .stat-label {
            display: block;
            color: #6b7280;
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--test-primary);
        }

        /* مراجعة الإجابات */
        .answers-review {
            margin-top: 40px;
            padding: 30px;
            background: #f8fafc;
            border-radius: 15px;
            border: 2px solid #e5e7eb;
        }

        .answers-review h3 {
            color: var(--test-primary);
            margin-bottom: 25px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .answer-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-right: 5px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .answer-item.correct {
            border-right-color: var(--test-success);
            background: linear-gradient(to left, #f0fff4, white);
        }

        .answer-item.incorrect {
            border-right-color: var(--test-danger);
            background: linear-gradient(to left, #fff5f5, white);
        }

        .answer-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .answer-question {
            font-weight: 700;
            margin-bottom: 10px;
            color: #2d3748;
            font-size: 1.1rem;
        }

        .answer-question .q-number {
            background: var(--test-primary);
            color: white;
            padding: 3px 10px;
            border-radius: 5px;
            margin-left: 10px;
        }

        .answer-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .answer-details {
                grid-template-columns: 1fr;
            }
        }

        .user-answer, .correct-answer {
            padding: 12px;
            border-radius: 8px;
            background: #f8fafc;
        }

        .user-answer {
            border: 2px solid #d1d5db;
        }

        .correct-answer {
            border: 2px solid var(--test-success);
            background: #f0fff4;
        }

        .answer-label {
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 5px;
            display: block;
            font-size: 0.9rem;
        }

        .answer-text {
            font-weight: 500;
            color: #374151;
        }

        .answer-group {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-top: 10px;
            display: inline-block;
            background: #f3f4f6;
            padding: 3px 10px;
            border-radius: 12px;
        }

        /* زر التبديل بين مراجعة الإجابات */
        .toggle-review-btn {
            background: none;
            border: 2px solid var(--test-primary);
            color: var(--test-primary);
            padding: 10px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            margin: 20px auto;
        }

        .toggle-review-btn:hover {
            background: var(--test-primary);
            color: white;
            transform: translateY(-2px);
        }

        /* تحسينات للجوال */
        @media (max-width: 768px) {
            .test-header {
                padding: 20px;
            }
            
            .test-header h1 {
                font-size: 1.8rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .test-meta-info {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .test-question {
                padding: 20px;
            }
            
            .question-text {
                font-size: 1.1rem;
                padding: 15px;
            }
            
            .results-score {
                flex-direction: column;
                gap: 30px;
            }
            
            .score-circle {
                width: 150px;
                height: 150px;
            }
            
            .score-value {
                font-size: 2.5rem;
            }
            
            .test-navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn, .submit-btn {
                width: 100%;
                justify-content: center;
            }
            
            .questions-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* تنبيه الوقت */
        .time-warning {
            background: linear-gradient(135deg, #ffc107, #ff9800);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 600;
            animation: pulseWarning 1s infinite;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.2);
        }

        @keyframes pulseWarning {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* إشعار إتمام الإجابات */
        .completion-notice {
            background: linear-gradient(135deg, var(--test-success), #28a745);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- شريط التنقل -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <a href="../index.html" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-graduation-cap"></i>
                    <h1>طلاب الأستاذة إسلام</h1>
                </a>
            </div>
            <div class="test-info">
                <div class="test-timer">
                    <i class="fas fa-clock"></i>
                    <span id="timer">20:00</span>
                </div>
                <div class="test-progress">
                    <span>السؤال <span id="current-question">1</span> من 25</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- محتوى الاختبار -->
    <main class="test-content">
        <div class="test-header">
            <h1><i class="fas fa-trophy"></i> الاختبار الشامل: الجوهرة المصرية</h1>
            <p>اختبار شامل لقياس مدى استيعابك لقصة الشهيد محمد أبو شقرة (الجوهرة المصرية)</p>
            
            <div class="test-meta-info">
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>الوقت: 20 دقيقة</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-question-circle"></i>
                    <span>عدد الأسئلة: 25 سؤالاً</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-star"></i>
                    <span>الدرجة الكلية: 100 نقطة</span>
                </div>
            </div>
        </div>

        <!-- شريط تقدم الأسئلة -->
        <div class="questions-progress" id="questions-progress">
            <div class="progress-header">
                <div class="progress-title">
                    <i class="fas fa-tasks"></i>
                    <span>حالة الأسئلة</span>
                </div>
                <div class="progress-count" id="answered-count">0 / 25</div>
            </div>
            <div class="questions-grid" id="questions-grid">
                <!-- سيتم ملؤه بالجافاسكريبت -->
            </div>
        </div>

        <!-- إشعار إتمام الإجابات -->
        <div class="completion-notice hidden" id="completion-notice">
            <i class="fas fa-check-circle"></i>
            <span>ممتاز! لقد أجبت على جميع الأسئلة ✓</span>
        </div>

        <!-- تنبيه الوقت -->
        <div class="time-warning hidden" id="time-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <span>انتبه! باقي 5 دقائق فقط على انتهاء الوقت</span>
        </div>

        <!-- أسئلة الاختبار -->
        <form id="test-form">
            <!-- سيتم إضافة الأسئلة ديناميكياً بالجافاسكريبت -->
        </form>

        <!-- نتائج الاختبار -->
        <div class="test-results hidden" id="test-results">
            <div class="results-card">
                <h2><i class="fas fa-medal"></i> نتائج الاختبار الشامل</h2>
                
                <div class="results-score">
                    <div class="score-circle">
                        <div class="score-value" id="final-score">0</div>
                        <div class="score-label">من 100</div>
                    </div>
                    
                    <div class="score-details">
                        <div class="score-stat">
                            <span class="stat-label">الإجابات الصحيحة:</span>
                            <span class="stat-value" id="correct-count">0</span>
                        </div>
                        
                        <div class="score-stat">
                            <span class="stat-label">الإجابات الخاطئة:</span>
                            <span class="stat-value" id="wrong-count">0</span>
                        </div>
                        
                        <div class="score-stat">
                            <span class="stat-label">النسبة المئوية:</span>
                            <span class="stat-value" id="percentage">0%</span>
                        </div>
                        
                        <div class="score-stat">
                            <span class="stat-label">الوقت المستغرق:</span>
                            <span class="stat-value" id="time-taken">0:00</span>
                        </div>
                    </div>
                </div>
                
                <div class="results-message" id="results-message">
                    <!-- سيتم ملؤه بالجافاسكريبت -->
                </div>
                
                <!-- قسم مراجعة الإجابات -->
                <div class="answers-review hidden" id="answers-review">
                    <h3><i class="fas fa-clipboard-check"></i> مراجعة الإجابات</h3>
                    <div id="answers-container">
                        <!-- سيتم ملؤه بالجافاسكريبت -->
                    </div>
                </div>
                
                <button class="toggle-review-btn" onclick="toggleAnswersReview()" id="toggle-review-btn">
                    <i class="fas fa-eye"></i> عرض مراجعة الإجابات
                </button>
                
                <div class="test-navigation">
                    <button class="btn-outline" onclick="retryTest()">
                        <i class="fas fa-redo"></i> إعادة الاختبار
                    </button>
                    
                    <button class="btn" onclick="goToHome()">
                        <i class="fas fa-home"></i> العودة للرئيسية
                    </button>
                    
                    <button class="btn" onclick="printResults()">
                        <i class="fas fa-print"></i> طباعة النتائج
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- التذييل -->
    <footer class="test-footer">
        <div class="footer-content">
            <p>الاختبار الشامل - قصة الشهيد محمد أبو شقرة (الجوهرة المصرية)</p>
            <p>الصف الأول الإعدادي - تحت إشراف الأستاذة إسلام محمد</p>
            <p>© 2026 جميع الحقوق محفوظة</p>
        </div>
    </footer>

    <!-- جافاسكريبت محسن للاختبار -->
    <script>
        // تعريف الأسئلة المحسنة مع إجاباتها الصحيحة
        const testQuestions = [
            // مجموعة أسئلة الفهم والاستيعاب (10 أسئلة)
            {
                id: 1,
                text: "في أي عام وُلِد الشهيد محمد أبو شقرة؟",
                options: [
                    { value: "a", text: "١٩٨٣م" },
                    { value: "b", text: "١٩٧٥م" },
                    { value: "c", text: "١٩٩٠م" },
                    { value: "d", text: "١٩٨٠م" }
                ],
                correctAnswer: "a",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "وُلِد الشهيد محمد أبو شقرة في عام ١٩٨٣م في محافظة الفيوم."
            },
            {
                id: 2,
                text: "ما اسم الكلية التي تخرج فيها الشهيد محمد أبو شقرة؟",
                options: [
                    { value: "a", text: "الكلية الحربية" },
                    { value: "b", text: "كلية الشرطة" },
                    { value: "c", text: "كلية الحقوق" },
                    { value: "d", text: "كلية التجارة" }
                ],
                correctAnswer: "b",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "التحق الشهيد بكلية الشرطة وتخرج فيها ضابطاً."
            },
            {
                id: 3,
                text: "لماذا لُقِب الشهيد محمد أبو شقرة بـ'الشبح' بين زملائه؟",
                options: [
                    { value: "a", text: "لأنه كان يعمل في الليل فقط" },
                    { value: "b", text: "لقدرته الكبيرة على التخفي والتمويه" },
                    { value: "c", text: "لأنه كان يظهر فجأة ويختفي" },
                    { value: "d", text: "لون بشرته الفاتح" }
                ],
                correctAnswer: "b",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "لُقِب بـ'الشبح' لما له من قدرة كبيرة على التخفي وتنفيذ المهام المكلف بها."
            },
            {
                id: 4,
                text: "في أي محافظة وُلِد الشهيد محمد أبو شقرة؟",
                options: [
                    { value: "a", text: "القاهرة" },
                    { value: "b", text: "الإسكندرية" },
                    { value: "c", text: "الفيوم" },
                    { value: "d", text: "الجيزة" }
                ],
                correctAnswer: "c",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "وُلِد الشهيد في محافظة الفيوم ونشأ في بيت يُقَدِّر الشرف والواجب."
            },
            {
                id: 5,
                text: "ما تاريخ استشهاد محمد أبو شقرة؟",
                options: [
                    { value: "a", text: "٩ يونيو ٢٠١٣م" },
                    { value: "b", text: "١٠ يناير ٢٠١٤م" },
                    { value: "c", text: "١٥ مارس ٢٠١٢م" },
                    { value: "d", text: "٢٥ ديسمبر ٢٠١٣م" }
                ],
                correctAnswer: "a",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "ارتقى الشهيد في ٩ يونيو ٢٠١٣م أثناء قيامه بمهمة خاصة في العريش."
            },
            {
                id: 6,
                text: "ما المنطقة التي كان الشهيد يعمل فيها ضد الإرهاب؟",
                options: [
                    { value: "a", text: "وادي النطرون" },
                    { value: "b", text: "شمال سيناء" },
                    { value: "c", text: "الصحراء الغربية" },
                    { value: "d", text: "دلتا النيل" }
                ],
                correctAnswer: "b",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "كان يعمل في مواجهة الإرهاب والتطرف في شمال سيناء، تحديداً في جبل الحلال والعريش."
            },
            {
                id: 7,
                text: "كيف كان الشهيد يتعامل مع الأيتام والفقراء؟",
                options: [
                    { value: "a", text: "كان يتجاهلهم" },
                    { value: "b", text: "كان يساعدهم في صمت وإشفاق" },
                    { value: "c", text: "كان يقدم لهم المساعدة أمام الجميع" },
                    { value: "d", text: "كان يحولهم للجمعيات الخيرية" }
                ],
                correctAnswer: "b",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "كان الشهيد يكفل الأيتام ويساعد الأسر البسيطة في صمت وإشفاق، دون أن يتباهى بذلك."
            },
            {
                id: 8,
                text: "ما المهمة الخطيرة التي أنجزها الشهيد بنجاح منقطع النظير؟",
                options: [
                    { value: "a", text: "تأمين مؤتمر دولي" },
                    { value: "b", text: "حماية ضيوف مصر من كبار الشخصيات العالمية" },
                    { value: "c", text: "تدمير معسكر إرهابي" },
                    { value: "d", text: "إنقاذ رهائن" }
                ],
                correctAnswer: "b",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "أسندت إليه مهمة حماية ضيوف مصر من كبار الشخصيات العالمية وأنجزها بنجاح منقطع النظير."
            },
            {
                id: 9,
                text: "كيف وصف النص شخصية الشهيد في تعامله مع زملائه؟",
                options: [
                    { value: "a", text: "كان متكبراً ومتعالياً" },
                    { value: "b", text: "كان أخاً متواضعاً يشاركهم همومهم" },
                    { value: "c", text: "كان قاسياً وصارماً" },
                    { value: "d", text: "كان منعزلاً لا يختلط بهم" }
                ],
                correctAnswer: "b",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "كان الشهيد أخاً متواضعاً يشارك زملاءه همومهم قبل أفراحهم."
            },
            {
                id: 10,
                text: "ما الهدف الرئيسي من قصة الشهيد محمد أبو شقرة حسب النص؟",
                options: [
                    { value: "a", text: "التعريف بمحافظة الفيوم" },
                    { value: "b", text: "بيان أهمية كلية الشرطة" },
                    { value: "c", text: "تقديم درس في الولاء والانتماء وحب الوطن" },
                    { value: "d", text: "التحذير من مخاطر الإرهاب" }
                ],
                correctAnswer: "c",
                group: "الفهم والاستيعاب",
                points: 4,
                explanation: "قصة الشهيد تقدم درساً عظيماً في الولاء والانتماء وحب الوطن والتضحية من أجله."
            },

            // مجموعة أسئلة المفردات واللغة (8 أسئلة)
            {
                id: 11,
                text: "ما مرادف كلمة 'حافل' في الجملة: 'تاريخ مصر الحديث حافل بنماذج مضيئة'؟",
                options: [
                    { value: "a", text: "قديم" },
                    { value: "b", text: "مليء وزاخر" },
                    { value: "c", text: "قصير" },
                    { value: "d", text: "ممتد" }
                ],
                correctAnswer: "b",
                group: "المفردات واللغة",
                points: 4,
                explanation: "مرادف 'حافل' هو مليء وزاخر."
            },
            {
                id: 12,
                text: "ما مضاد كلمة 'صَوْنَ' في النص؟",
                options: [
                    { value: "a", text: "حماية" },
                    { value: "b", text: "حفظ" },
                    { value: "c", text: "إهدار وتضييع" },
                    { value: "d", text: "رعاية" }
                ],
                correctAnswer: "c",
                group: "المفردات واللغة",
                points: 4,
                explanation: "مضاد 'صَوْنَ' هو إهدار وتضييع."
            },
            {
                id: 13,
                text: "ما معنى 'وَهَبُوا' في قوله: 'وهبوا حياتهم دفاعاً عن أمنها'؟",
                options: [
                    { value: "a", text: "أخذوا" },
                    { value: "b", text: "منحوا وقدموا" },
                    { value: "c", text: "حفظوا" },
                    { value: "d", text: "استعادوا" }
                ],
                correctAnswer: "b",
                group: "المفردات واللغة",
                points: 4,
                explanation: "معنى 'وَهَبُوا' هو منحوا وقدموا."
            },
            {
                id: 14,
                text: "عبارة 'منقطع النظير' تعني:",
                options: [
                    { value: "a", text: "سريع الانقطاع" },
                    { value: "b", text: "لا مثيل له" },
                    { value: "c", text: "غير منظور" },
                    { value: "d", text: "بعيد عن الأنظار" }
                ],
                correctAnswer: "b",
                group: "المفردات واللغة",
                points: 4,
                explanation: "'منقطع النظير' تعني لا مثيل له."
            },
            {
                id: 15,
                text: "ما معنى 'يَتَحَلَّى' في وصف الشهيد بأنه 'يتحلى بالانضباط والشجاعة'؟",
                options: [
                    { value: "a", text: "يتجنب" },
                    { value: "b", text: "يتزين ويتصف" },
                    { value: "c", text: "يخفي" },
                    { value: "d", text: "يبتعد عن" }
                ],
                correctAnswer: "b",
                group: "المفردات واللغة",
                points: 4,
                explanation: "'يَتَحَلَّى' تعني يتزين ويتصف بصفة ما."
            },
            {
                id: 16,
                text: "ما مفرد كلمة 'بُور' في النص؟",
                options: [
                    { value: "a", text: "بُوَير" },
                    { value: "b", text: "بُورَة" },
                    { value: "c", text: "بَار" },
                    { value: "d", text: "بُورَان" }
                ],
                correctAnswer: "b",
                group: "المفردات واللغة",
                points: 4,
                explanation: "مفرد 'بُور' هو 'بُورَة'."
            },
            {
                id: 17,
                text: "كلمة 'ارْتَقَى' في سياق الاستشهاد تعني:",
                options: [
                    { value: "a", text: "نزل مرتبة" },
                    { value: "b", text: "ارتفع وعلت منزلته" },
                    { value: "c", text: "ذهب بعيداً" },
                    { value: "d", text: "تقدم في العمر" }
                ],
                correctAnswer: "b",
                group: "المفردات واللغة",
                points: 4,
                explanation: "في سياق الاستشهاد، 'ارْتَقَى' تعني ارتفع وعلت منزلته."
            },
            {
                id: 18,
                text: "ما مرادف 'يَغْمُرُهُم' في الجملة: 'يغمرهم بالحب والابتسامة'؟",
                options: [
                    { value: "a", text: "يُبعدهم" },
                    { value: "b", text: "يُقصيهم" },
                    { value: "c", text: "يَشملهم ويملؤهم" },
                    { value: "d", text: "يخيفهم" }
                ],
                correctAnswer: "c",
                group: "المفردات واللغة",
                points: 4,
                explanation: "مرادف 'يَغْمُرُهُم' هو يَشملهم ويملؤهم."
            },

            // مجموعة أسئلة القواعد والإملاء (7 أسئلة)
            {
                id: 19,
                text: "الكتابة الصحيحة للكلمة التي تنتهي بهمزة متوسطة على السطر هي:",
                options: [
                    { value: "a", text: "شيئًا" },
                    { value: "b", text: "جزءًا" },
                    { value: "c", text: "سوءًا" },
                    { value: "d", text: "بناءً" }
                ],
                correctAnswer: "b",
                group: "القواعد والإملاء",
                points: 4,
                explanation: "الكلمة الصحيحة هي 'جزءًا' حيث تكتب الهمزة على السطر إذا جاءت مفتوحة بعد ألف."
            },
            {
                id: 20,
                text: "ما نوع الهمزة في كلمة 'مُضِيئَةٍ'؟",
                options: [
                    { value: "a", text: "همزة وصل" },
                    { value: "b", text: "همزة قطع" },
                    { value: "c", text: "همزة متطرفة" },
                    { value: "d", text: "همزة متوسطة" }
                ],
                correctAnswer: "d",
                group: "القواعد والإملاء",
                points: 4,
                explanation: "همزة 'مُضِيئَةٍ' همزة متوسطة لأنها جاءت في وسط الكلمة."
            },
            {
                id: 21,
                text: "علامة إعراب كلمة 'الضَّابِط' في الجملة: 'تخرَّج ضابطًا شابًا' هي:",
                options: [
                    { value: "a", text: "مرفوعة بالضمة" },
                    { value: "b", text: "منصوبة بالفتحة" },
                    { value: "c", text: "مجرورة بالكسرة" },
                    { value: "d", text: "منصوبة بالياء" }
                ],
                correctAnswer: "b",
                group: "القواعد والإملاء",
                points: 4,
                explanation: "كلمة 'ضابطًا' حال منصوبة بالفتحة الظاهرة."
            },
            {
                id: 22,
                text: "ما إعراب كلمة 'شَهِيدًا' في الجملة: 'ارتقى شَهيدًا'؟",
                options: [
                    { value: "a", text: "مفعول به" },
                    { value: "b", text: "حال" },
                    { value: "c", text: "تمييز" },
                    { value: "d", text: "مفعول مطلق" }
                ],
                correctAnswer: "b",
                group: "القواعد والإملاء",
                points: 4,
                explanation: "كلمة 'شَهيدًا' حال منصوبة بالفتحة."
            },
            {
                id: 23,
                text: "الجملة التي بها فعل متعدٍ لمفعولين هي:",
                options: [
                    { value: "a", text: "سار الجندي بسرعة" },
                    { value: "b", text: "أعطى المعلم الطالب جائزة" },
                    { value: "c", text: "نام الطفل مبكرًا" },
                    { value: "d", text: "جلس الضيف في الصالة" }
                ],
                correctAnswer: "b",
                group: "القواعد والإملاء",
                points: 4,
                explanation: "الفعل 'أعطى' متعدٍ لمفعولين: 'الطالب' مفعول به أول، و'جائزة' مفعول به ثان."
            },
            {
                id: 24,
                text: "ما نوع الأسلوب في الجملة: 'إنَّ الوطن ليحتاج إلى أبنائه'؟",
                options: [
                    { value: "a", text: "أسلوب تعجب" },
                    { value: "b", text: "أسلوب استفهام" },
                    { value: "c", text: "أسلوب توكيد" },
                    { value: "d", text: "أسلوب نداء" }
                ],
                correctAnswer: "c",
                group: "القواعد والإملاء",
                points: 4,
                explanation: "الجملة تحتوي على أسلوب توكيد بأدوات التوكيد 'إنَّ' و'اللام'."
            },
            {
                id: 25,
                text: "الكلمة التي كُتبت همزتها كتابة صحيحة هي:",
                options: [
                    { value: "a", text: "سؤال" },
                    { value: "b", text: "مسئولية" },
                    { value: "c", text: "رأس" },
                    { value: "d", text: "فائز" }
                ],
                correctAnswer: "d",
                group: "القواعد والإملاء",
                points: 4,
                explanation: "كلمة 'فائز' كُتبت همزتها على السطر كتابة صحيحة لأنها ساكنة وما قبلها مكسور."
            }
        ];

        // متغيرات الاختبار
        let currentQuestion = 1;
        const totalQuestions = testQuestions.length;
        let timeLeft = 20 * 60; // 20 دقيقة بالثواني
        let timerInterval;
        let startTime;
        let shuffledQuestions = [];
        let userAnswers = {};
        let hasTimeWarningShown = false;

        // تهيئة الاختبار
        function initTest() {
            // خلط الأسئلة عشوائياً
            shuffledQuestions = shuffleArray([...testQuestions]);
            
            // عرض الأسئلة
            renderQuestions();
            
            // بدء المؤقت والتسجيل
            startTime = new Date();
            startTimer();
            
            // تحديث العرض
            updateQuestionDisplay();
            
            // إعداد مستمعي الأحداث
            setupEventListeners();
            
            // تهيئة شريط التقدم
            updateQuestionsProgress();
            
            // تحميل الإجابات المحفوظة
            loadSavedAnswers();
        }

        // دالة لخلط الأسئلة
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // عرض الأسئلة
        function renderQuestions() {
            const form = document.getElementById('test-form');
            form.innerHTML = '';
            
            shuffledQuestions.forEach((question, index) => {
                const questionNumber = index + 1;
                const letters = ['أ', 'ب', 'ج', 'د'];
                
                const questionHTML = `
                    <div class="test-question ${questionNumber === 1 ? 'active' : ''}" id="question${questionNumber}">
                        <div class="question-header">
                            <h3><i class="fas fa-question-circle"></i> السؤال ${questionNumber}</h3>
                            <span class="question-points">${question.points} نقاط</span>
                        </div>
                        
                        <div class="question-group">
                            <span class="group-badge">${question.group}</span>
                        </div>
                        
                        <div class="question-text">
                            ${question.text}
                        </div>
                        
                        <div class="question-options">
                            ${question.options.map((option, optIndex) => `
                                <label class="question-option" data-question="${question.id}" data-option="${option.value}">
                                    <input type="radio" name="q${question.id}" value="${option.value}">
                                    <span class="option-letter">${letters[optIndex]}</span>
                                    <span class="option-text">${option.text}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                form.insertAdjacentHTML('beforeend', questionHTML);
            });
            
            // إضافة أزرار التنقل
            const navigationHTML = `
                <div class="test-navigation">
                    <button type="button" class="nav-btn" id="prev-btn" disabled>
                        <i class="fas fa-arrow-right"></i> السابق
                    </button>
                    
                    <button type="button" class="nav-btn" id="next-btn">
                        التالي <i class="fas fa-arrow-left"></i>
                    </button>
                    
                    <button type="button" class="submit-btn" id="submit-test">
                        <i class="fas fa-paper-plane"></i> إنهاء الاختبار
                    </button>
                </div>
            `;
            
            form.insertAdjacentHTML('beforeend', navigationHTML);
            
            // إعادة ربط مستمعي الأحداث
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            document.getElementById('prev-btn').addEventListener('click', prevQuestion);
            document.getElementById('submit-test').addEventListener('click', handleSubmitTest);
            
            // إضافة مستمعي الأحداث لخيارات الإجابة
            document.querySelectorAll('.question-option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionId = this.dataset.question;
                    const optionValue = this.dataset.option;
                    selectAnswer(questionId, optionValue, this);
                });
            });
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // مستمع لتغيير الإجابة
            document.addEventListener('click', function(event) {
                if (event.target.closest('.question-option')) {
                    const option = event.target.closest('.question-option');
                    const questionId = option.dataset.question;
                    const optionValue = option.dataset.option;
                    selectAnswer(questionId, optionValue, option);
                }
            });
            
            // مستمعات للأزرار
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            document.getElementById('prev-btn').addEventListener('click', prevQuestion);
            document.getElementById('submit-test').addEventListener('click', handleSubmitTest);
            
            // مستمعات للوحة المفاتيح
            document.addEventListener('keydown', function(event) {
                if (event.key === 'ArrowRight') prevQuestion();
                if (event.key === 'ArrowLeft') nextQuestion();
                if (event.key === 'Enter' && !document.getElementById('test-results').classList.contains('hidden')) {
                    goToHome();
                }
            });
        }

        // بدء المؤقت
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                // التحقق من الوقت المتبقي
                if (timeLeft <= 5 * 60 && !hasTimeWarningShown) {
                    showTimeWarning();
                    hasTimeWarningShown = true;
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showTimeUpMessage();
                    setTimeout(completeTestSubmission, 2000);
                }
            }, 1000);
        }

        // تحديث عرض المؤقت
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // عرض تحذير الوقت
        function showTimeWarning() {
            const warningDiv = document.getElementById('time-warning');
            warningDiv.classList.remove('hidden');
            
            // إخفاء التحذير بعد 10 ثوانٍ
            setTimeout(() => {
                warningDiv.classList.add('hidden');
            }, 10000);
        }

        // عرض رسالة انتهاء الوقت
        function showTimeUpMessage() {
            const form = document.getElementById('test-form');
            const timeUpHTML = `
                <div class="time-warning" style="background: linear-gradient(135deg, #dc3545, #c82333); animation: none;">
                    <i class="fas fa-clock"></i>
                    <span>انتهى الوقت! سيتم تصحيح الاختبار الآن...</span>
                </div>
            `;
            form.insertAdjacentHTML('afterbegin', timeUpHTML);
        }

        // تحديث شريط تقدم الأسئلة
        function updateQuestionsProgress() {
            const grid = document.getElementById('questions-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            let answeredCount = 0;
            
            shuffledQuestions.forEach((question, index) => {
                const questionNumber = index + 1;
                const questionElement = document.getElementById(`question${questionNumber}`);
                const selectedOption = questionElement ? questionElement.querySelector('input[type="radio"]:checked') : null;
                const isAnswered = !!selectedOption;
                const isCurrent = currentQuestion === questionNumber;
                
                if (isAnswered) answeredCount++;
                
                const statusElement = document.createElement('div');
                statusElement.className = `question-status ${isAnswered ? 'answered' : 'unanswered'} ${isCurrent ? 'current' : ''}`;
                statusElement.title = `السؤال ${questionNumber}: ${isAnswered ? 'مجاب' : 'غير مجاب'}`;
                statusElement.innerHTML = `<span>${questionNumber}</span>`;
                statusElement.dataset.question = questionNumber;
                
                statusElement.addEventListener('click', () => {
                    currentQuestion = questionNumber;
                    updateQuestionDisplay();
                });
                
                grid.appendChild(statusElement);
            });
            
            // تحديث العداد
            document.getElementById('answered-count').textContent = `${answeredCount} / ${totalQuestions}`;
            document.getElementById('current-question').textContent = currentQuestion;
            
            // عرض إشعار إتمام الإجابات إذا تمت الإجابة على جميع الأسئلة
            const completionNotice = document.getElementById('completion-notice');
            if (answeredCount === totalQuestions) {
                completionNotice.classList.remove('hidden');
            } else {
                completionNotice.classList.add('hidden');
            }
        }

        // اختيار إجابة
        function selectAnswer(questionId, optionValue, optionElement) {
            // إلغاء تحديد جميع خيارات السؤال
            const questionElement = optionElement.closest('.test-question');
            questionElement.querySelectorAll('.question-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.querySelector('input[type="radio"]').checked = false;
            });
            
            // تحديد الخيار المختار
            optionElement.classList.add('selected');
            optionElement.querySelector('input[type="radio"]').checked = true;
            
            // حفظ الإجابة
            userAnswers[questionId] = optionValue;
            localStorage.setItem(`test2-q${questionId}`, optionValue);
            
            // تحديث شريط التقدم
            updateQuestionsProgress();
        }

        // الانتقال للسؤال التالي
        function nextQuestion() {
            if (currentQuestion < totalQuestions) {
                currentQuestion++;
                updateQuestionDisplay();
            }
        }

        // العودة للسؤال السابق
        function prevQuestion() {
            if (currentQuestion > 1) {
                currentQuestion--;
                updateQuestionDisplay();
            }
        }

        // تحديث عرض السؤال الحالي
        function updateQuestionDisplay() {
            // إخفاء جميع الأسئلة
            document.querySelectorAll('.test-question').forEach(question => {
                question.classList.remove('active');
            });
            
            // إظهار السؤال الحالي
            const currentQuestionElement = document.getElementById(`question${currentQuestion}`);
            if (currentQuestionElement) {
                currentQuestionElement.classList.add('active');
                
                // تمرير للعنصر
                currentQuestionElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // تحديث حالة أزرار التنقل
            document.getElementById('prev-btn').disabled = currentQuestion === 1;
            document.getElementById('next-btn').disabled = currentQuestion === totalQuestions;
            document.getElementById('next-btn').innerHTML = 
                currentQuestion === totalQuestions ? 'السؤال الأخير <i class="fas fa-flag-checkered"></i>' : 'التالي <i class="fas fa-arrow-left"></i>';
            
            // تحديث شريط تقدم الأسئلة
            updateQuestionsProgress();
        }

        // تحميل الإجابات المحفوظة
        function loadSavedAnswers() {
            shuffledQuestions.forEach(question => {
                const savedAnswer = localStorage.getItem(`test2-q${question.id}`);
                if (savedAnswer) {
                    userAnswers[question.id] = savedAnswer;
                    
                    // تحديث الواجهة
                    const questionElement = document.querySelector(`[data-question="${question.id}"]`);
                    if (questionElement) {
                        const optionToSelect = questionElement.closest('.test-question')
                            .querySelector(`input[value="${savedAnswer}"]`);
                        if (optionToSelect) {
                            optionToSelect.checked = true;
                            optionToSelect.closest('.question-option').classList.add('selected');
                        }
                    }
                }
            });
            
            updateQuestionsProgress();
        }

        // معالجة تسليم الاختبار
        function handleSubmitTest() {
            // التحقق من إكمال جميع الأسئلة
            const unansweredQuestions = checkUnansweredQuestions();
            
            if (unansweredQuestions.length > 0) {
                showUnansweredAlert(unansweredQuestions);
                return;
            }
            
            // تأكيد التسليم
            if (confirm('هل أنت متأكد من أنك تريد تسليم الاختبار؟\n\nبعد التسليم لا يمكنك العودة للإجابة عن الأسئلة.')) {
                completeTestSubmission();
            }
        }

        // التحقق من الأسئلة غير المجابة
        function checkUnansweredQuestions() {
            const unanswered = [];
            
            shuffledQuestions.forEach((question, index) => {
                if (!userAnswers[question.id]) {
                    unanswered.push({
                        number: index + 1,
                        question: question.text.substring(0, 50) + '...',
                        group: question.group
                    });
                }
            });
            
            return unanswered;
        }

        // عرض تنبيه بالأسئلة غير المجابة
        function showUnansweredAlert(unansweredQuestions) {
            let alertMessage = `
                <div style="padding: 20px;">
                    <h3 style="color: #dc3545; margin-bottom: 15px;">
                        <i class="fas fa-exclamation-triangle"></i> يوجد ${unansweredQuestions.length} أسئلة لم تتم الإجابة عليها
                    </h3>
                    <p>يرجى الإجابة على جميع الأسئلة قبل تسليم الاختبار.</p>
                    <div style="max-height: 200px; overflow-y: auto; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <ul style="list-style: none; padding: 0; margin: 0;">
            `;
            
            unansweredQuestions.forEach(item => {
                alertMessage += `
                    <li style="padding: 8px 0; border-bottom: 1px dashed #ddd;">
                        <strong>السؤال ${item.number}:</strong> ${item.question}
                        <span style="background: #6c757d; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 10px;">
                            ${item.group}
                        </span>
                    </li>
                `;
            });
            
            alertMessage += `
                        </ul>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="goToFirstUnanswered(${unansweredQuestions[0].number})" style="flex: 1; padding: 10px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            الانتقال للسؤال الأول غير مجاب
                        </button>
                        <button onclick="closeAlert()" style="flex: 1; padding: 10px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            إلغاء
                        </button>
                    </div>
                </div>
            `;
            
            // إنشاء وتخصيص عنصر التنبيه
            const alertDiv = document.createElement('div');
            alertDiv.id = 'custom-alert';
            alertDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            const alertContent = document.createElement('div');
            alertContent.style.cssText = `
                background: white;
                border-radius: 15px;
                width: 90%;
                max-width: 500px;
                max-height: 90vh;
                overflow: auto;
                animation: fadeIn 0.3s ease;
            `;
            alertContent.innerHTML = alertMessage;
            
            alertDiv.appendChild(alertContent);
            document.body.appendChild(alertDiv);
        }

        // الانتقال لأول سؤال غير مجاب
        window.goToFirstUnanswered = function(questionNumber) {
            closeAlert();
            currentQuestion = questionNumber;
            updateQuestionDisplay();
            
            // إضافة تأثير للسؤال
            const questionElement = document.getElementById(`question${questionNumber}`);
            questionElement.style.animation = 'none';
            setTimeout(() => {
                questionElement.style.animation = 'questionFadeIn 0.5s ease, highlightPulse 2s ease';
                questionElement.style.boxShadow = '0 0 0 3px rgba(220, 53, 69, 0.3)';
                questionElement.style.borderColor = '#dc3545';
                
                setTimeout(() => {
                    questionElement.style.boxShadow = '';
                    questionElement.style.borderColor = '';
                }, 2000);
            }, 10);
        };

        // إغلاق التنبيه
        window.closeAlert = function() {
            const alertDiv = document.getElementById('custom-alert');
            if (alertDiv) {
                alertDiv.remove();
            }
        };

        // إكمال تسليم الاختبار
        function completeTestSubmission() {
            clearInterval(timerInterval);
            
            // حساب الوقت المستغرق
            const endTime = new Date();
            const timeTaken = Math.floor((endTime - startTime) / 1000);
            const minutesTaken = Math.floor(timeTaken / 60);
            const secondsTaken = timeTaken % 60;
            
            // حساب النتائج
            let correctCount = 0;
            let wrongCount = 0;
            const answerDetails = [];
            
            shuffledQuestions.forEach(question => {
                const userAnswer = userAnswers[question.id];
                const isCorrect = userAnswer === question.correctAnswer;
                
                if (userAnswer) {
                    if (isCorrect) {
                        correctCount++;
                    } else {
                        wrongCount++;
                    }
                } else {
                    wrongCount++;
                }
                
                // تخزين تفاصيل الإجابة
                const userAnswerText = question.options.find(opt => opt.value === userAnswer)?.text || 'لم تتم الإجابة';
                const correctAnswerText = question.options.find(opt => opt.value === question.correctAnswer)?.text;
                
                answerDetails.push({
                    question: question.text,
                    userAnswer: userAnswerText,
                    correctAnswer: correctAnswerText,
                    isCorrect: isCorrect,
                    explanation: question.explanation,
                    group: question.group,
                    points: question.points
                });
            });
            
            // حساب النتيجة النهائية
            const score = correctCount * 4; // كل سؤال = 4 نقاط
            const percentage = Math.round((correctCount / totalQuestions) * 100);
            
            // عرض النتائج
            displayResults(score, percentage, correctCount, wrongCount, minutesTaken, secondsTaken, answerDetails);
            
            // حفظ النتائج
            saveTestResults(score, percentage, correctCount);
        }

        // عرض النتائج
        function displayResults(score, percentage, correctCount, wrongCount, minutesTaken, secondsTaken, answerDetails) {
            // تحديث العناصر
            document.getElementById('final-score').textContent = score;
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('wrong-count').textContent = wrongCount;
            document.getElementById('percentage').textContent = `${percentage}%`;
            document.getElementById('time-taken').textContent = `${minutesTaken}:${secondsTaken.toString().padStart(2, '0')}`;
            
            // عرض رسالة النتيجة
            const resultsMessage = document.getElementById('results-message');
            let messageHTML = '';
            
            if (percentage >= 90) {
                messageHTML = `
                    <div class="message success">
                        <i class="fas fa-trophy"></i>
                        <h3>ممتاز! أداء رائع</h3>
                        <p>لقد أظهرت فهماً عميقاً لقصة الشهيد محمد أبو شقرة. استمر في التميز!</p>
                        <div style="margin-top: 15px; font-size: 0.9em; color: #155724;">
                            <i class="fas fa-star"></i> حصلت على ${score} نقطة من أصل 100
                        </div>
                    </div>
                `;
            } else if (percentage >= 70) {
                messageHTML = `
                    <div class="message good">
                        <i class="fas fa-star"></i>
                        <h3>جيد جداً</h3>
                        <p>أداء جيد، لكن يمكنك التحسين أكثر. راجع الإجابات الخاطئة للاستفادة منها.</p>
                        <div style="margin-top: 15px; font-size: 0.9em; color: #856404;">
                            <i class="fas fa-chart-line"></i> نسبة نجاحك ${percentage}%
                        </div>
                    </div>
                `;
            } else if (percentage >= 50) {
                messageHTML = `
                    <div class="message improve">
                        <i class="fas fa-book"></i>
                        <h3>مستوى متوسط</h3>
                        <p>يحتاج أداؤك للتحسين. ننصحك بمراجعة قصة الشهيد مرة أخرى.</p>
                        <div style="margin-top: 15px; font-size: 0.9em; color: #721c24;">
                            <i class="fas fa-exclamation-circle"></i> تحتاج لتحسين فهمك للنص
                        </div>
                    </div>
                `;
            } else {
                messageHTML = `
                    <div class="message improve">
                        <i class="fas fa-redo"></i>
                        <h3>يحتاج للتحسين</h3>
                        <p>يجب عليك مراجعة الدرس مرة أخرى وفهم النص بشكل أفضل.</p>
                        <div style="margin-top: 15px; font-size: 0.9em; color: #721c24;">
                            <i class="fas fa-lightbulb"></i> حاول التركيز أكثر في المرة القادمة
                        </div>
                    </div>
                `;
            }
            
            resultsMessage.innerHTML = messageHTML;
            
            // إنشاء مراجعة الإجابات
            createAnswersReview(answerDetails);
            
            // إخفاء الأسئلة وإظهار النتائج
            document.getElementById('test-form').classList.add('hidden');
            document.getElementById('questions-progress').classList.add('hidden');
            document.getElementById('completion-notice').classList.add('hidden');
            document.getElementById('time-warning').classList.add('hidden');
            document.getElementById('test-results').classList.remove('hidden');
            
            // تمرير للنتائج
            document.getElementById('test-results').scrollIntoView({ behavior: 'smooth' });
        }

        // إنشاء مراجعة الإجابات
        function createAnswersReview(answerDetails) {
            const container = document.getElementById('answers-container');
            container.innerHTML = '';
            
            answerDetails.forEach((detail, index) => {
                const questionNumber = index + 1;
                const answerItem = document.createElement('div');
                answerItem.className = `answer-item ${detail.isCorrect ? 'correct' : 'incorrect'}`;
                
                answerItem.innerHTML = `
                    <div class="answer-question">
                        <span class="q-number">${questionNumber}</span>
                        ${detail.question}
                    </div>
                    
                    <div class="answer-details">
                        <div class="user-answer">
                            <span class="answer-label">إجابتك:</span>
                            <span class="answer-text">${detail.userAnswer}</span>
                            ${!detail.isCorrect ? `<div style="color: #dc3545; font-size: 0.9em; margin-top: 5px;">
                                <i class="fas fa-times-circle"></i> -${detail.points} نقطة
                            </div>` : `<div style="color: #28a745; font-size: 0.9em; margin-top: 5px;">
                                <i class="fas fa-check-circle"></i> +${detail.points} نقطة
                            </div>`}
                        </div>
                        
                        <div class="correct-answer">
                            <span class="answer-label">الإجابة الصحيحة:</span>
                            <span class="answer-text">${detail.correctAnswer}</span>
                        </div>
                    </div>
                    
                    ${detail.explanation ? `
                        <div style="margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-right: 3px solid #17a2b8;">
                            <div style="font-weight: 600; color: #17a2b8; margin-bottom: 5px;">
                                <i class="fas fa-lightbulb"></i> التوضيح:
                            </div>
                            <div style="color: #495057; font-size: 0.95rem;">
                                ${detail.explanation}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="answer-group">
                        <i class="fas fa-tag"></i> ${detail.group}
                    </div>
                `;
                
                container.appendChild(answerItem);
            });
        }

        // تبديل عرض مراجعة الإجابات
        function toggleAnswersReview() {
            const reviewDiv = document.getElementById('answers-review');
            const toggleBtn = document.getElementById('toggle-review-btn');
            
            if (reviewDiv.classList.contains('hidden')) {
                reviewDiv.classList.remove('hidden');
                toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i> إخفاء مراجعة الإجابات';
                reviewDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                reviewDiv.classList.add('hidden');
                toggleBtn.innerHTML = '<i class="fas fa-eye"></i> عرض مراجعة الإجابات';
            }
        }

        // حفظ نتائج الاختبار
        function saveTestResults(score, percentage, correctCount) {
            const testResults = {
                score: score,
                percentage: percentage,
                correctAnswers: correctCount,
                totalQuestions: totalQuestions,
                timestamp: new Date().toISOString(),
                testName: 'الاختبار الشامل: الجوهرة المصرية',
                date: new Date().toLocaleDateString('ar-EG')
            };
            
            localStorage.setItem('test2-results', JSON.stringify(testResults));
            
            // تحديث تقدم المستخدم إذا نجح
            if (percentage >= 70) {
                localStorage.setItem('test2-completed', 'true');
                updateUserProgress();
            }
        }

        // تحديث تقدم المستخدم
        function updateUserProgress() {
            // تحديث التقدم العام
            let totalProgress = 0;
            let completedTests = 0;
            
            // اختبار 1
            if (localStorage.getItem('test1-completed') === 'true') {
                totalProgress += 25;
                completedTests++;
            }
            
            // اختبار 2
            if (localStorage.getItem('test2-completed') === 'true') {
                totalProgress += 25;
                completedTests++;
            }
            
            // اختبارات أخرى...
            
            // حفظ التقدم
            localStorage.setItem('user-progress', totalProgress.toString());
            localStorage.setItem('completed-tests', completedTests.toString());
            
            // إشعار النجاح
            setTimeout(() => {
                if (completedTests === 2) {
                    showAchievementNotification();
                }
            }, 1000);
        }

        // عرض إشعار الإنجاز
        function showAchievementNotification() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ffc107, #ff9800);
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 3000;
                animation: slideInRight 0.5s ease;
                max-width: 300px;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <i class="fas fa-trophy" style="font-size: 2rem;"></i>
                    <div>
                        <h4 style="margin: 0 0 5px 0;">إنجاز متميز! 🎉</h4>
                        <p style="margin: 0; font-size: 0.9em;">لقد أكملت الاختبارين بنجاح!</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // إزالة الإشعار بعد 5 ثوانٍ
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }

        // إعادة الاختبار
        function retryTest() {
            if (confirm('هل تريد إعادة الاختبار من البداية؟ سيتم مسح جميع إجاباتك الحالية.')) {
                // مسح الإجابات المحفوظة
                testQuestions.forEach(question => {
                    localStorage.removeItem(`test2-q${question.id}`);
                });
                
                // إعادة تحميل الصفحة
                location.reload();
            }
        }

        // العودة للرئيسية
        function goToHome() {
            window.location.href = '../index.html';
        }

        // طباعة النتائج
        function printResults() {
            const printContent = document.getElementById('test-results').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <div dir="rtl" style="font-family: 'Cairo', sans-serif; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="color: #4a6fa5;">نتائج الاختبار الشامل</h1>
                        <h2 style="color: #166088;">قصة الشهيد محمد أبو شقرة (الجوهرة المصرية)</h2>
                        <p>الصف الأول الإعدادي - تحت إشراف الأستاذة إسلام محمد</p>
                        <p>تاريخ الطباعة: ${new Date().toLocaleDateString('ar-EG')}</p>
                    </div>
                    ${printContent}
                </div>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            location.reload();
        }

        // تهيئة الاختبار عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', initTest);
        
        // التحذير عند محاولة الخروج
        window.addEventListener('beforeunload', function(e) {
            if (!document.getElementById('test-results').classList.contains('hidden')) {
                return undefined;
            }
            
            const unanswered = checkUnansweredQuestions();
            if (unanswered.length > 0) {
                e.preventDefault();
                e.returnValue = 'لديك اختبار قيد التقدم مع أسئلة غير مجابة. هل أنت متأكد من أنك تريد المغادرة؟';
                return e.returnValue;
            }
        });

        // إضافة أنماط CSS للرسوم المتحركة
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            
            @keyframes highlightPulse {
                0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
                70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
                100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
            }
            
            .message {
                padding: 25px;
                border-radius: 12px;
                margin: 25px 0;
                text-align: center;
                border: 2px solid;
            }
            
            .message.success {
                background: linear-gradient(135deg, #d4edda, #c3e6cb);
                border-color: #28a745;
                color: #155724;
            }
            
            .message.good {
                background: linear-gradient(135deg, #fff3cd, #ffeaa7);
                border-color: #ffc107;
                color: #856404;
            }
            
            .message.improve {
                background: linear-gradient(135deg, #f8d7da, #f5c6cb);
                border-color: #dc3545;
                color: #721c24;
            }
            
            .message i {
                font-size: 2.5rem;
                margin-bottom: 15px;
            }
            
            .message h3 {
                margin: 0 0 10px 0;
                font-size: 1.5rem;
            }
            
            .message p {
                margin: 0;
                font-size: 1.1rem;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>